# hLRS_Radio_Link
Homebrew OTA protocol for ELRS modules and CRSF protocol
The ELRS transceiver modules used in RC models happen to be almost identical to the hardware of my previous project, SX1281 BLE transceiver. With the exception that at the place of the place ESP8266 and its external 4MB flash memory there is a ESP8255 with 1 MB internal flash. If the 4 MB are not needed, the internal flash is an advantage because the ESP8255 is protected against readout. 
![P1093254](https://github.com/user-attachments/assets/ddcbcb0f-ef34-4e86-8d29-ab15b4bc534b)   ![P1093238](https://github.com/user-attachments/assets/a0a3a727-660f-43f8-9b34-351b810f0672)
It was straightforward to have the previously written firmware run on this much more compact module by very few minor adjustments. After this, it is challenging to write own firmware for the module acting as RC transceiver. The objective is that it remains compatible to the CRSF standard on the wired side. Furthermore, autodetection of its roll as "transmitter" or "receiver" shall be implemented. On both sides of the radio link, there is actually a transceiver because the link is bidirectional for transmitting telemetry data over the downlink and to be able to monitor the link quality at all times. So far, the so called "receiver" modules can also be use as "transmitter" but need to be flashed with specifically built version of the firmware.
The aim here is by no means to compete with the performance of the existing ELRS. The update rate shall be much slower, channel hopping is not yet implemented and at least for now, there is less protection against jamming or interference with other users. However, once an operational prototype is available, it gives some flexibility regarding future add-ons. Also, the software is entirely written in Arduino IDE and does not rely on radio libraries, but uses the register access method from the previous project. Therefore, shifting between LoRa, GFSK, FLRC and BLE should be possible.
A similar project exists under the name of mLRS. However, this is also a protocol that is more advanced and aims at increased performance. In this context, it is often claimed that in principle the radio link should just be a plain transparent serial connection. Since basically, a quadrocopter can be controlles simply by connecting a serial wire from the RC to the flight controller. This is only partially true, because the radio link, unless if it has two RF modules on both sides, is only half-duplex. Consequently, inbound packets may be lost or otherwise would have to be queued (i opt for loss..). Also it should be mentioned that besides sending packets to the opposite side, the transceivers must create some "fake" packets and insert them into the stream: when using a serial cable, there would be no "link statistics" and the corresponding packet, although formally a telemetry frame, cannot originate from the flight controller. To obtain such a packet, the two transceivers must send each other their link data, and at the RC side, the packet must then be composed from this data. Likewise, in the case of connection loss, the receiver must generate a fake channel control frame with the failsafe flag set.
The schematics of the functions that the firmware must accomplish is this:
